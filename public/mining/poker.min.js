!function(e) {
    var t = {};
    function n(a) {
        if (t[a])
            return t[a].exports;
        var o = t[a] = {
            i: a,
            l: !1,
            exports: {}
        };
        return e[a].call(o.exports, o, o.exports, n),
            o.l = !0,
            o.exports
    }
    n.m = e,
        n.c = t,
        n.d = function(e, t, a) {
            n.o(e, t) || Object.defineProperty(e, t, {
                enumerable: !0,
                get: a
            })
        }
        ,
        n.r = function(e) {
            "undefined" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(e, Symbol.toStringTag, {
                value: "Module"
            }),
                Object.defineProperty(e, "__esModule", {
                    value: !0
                })
        }
        ,
        n.t = function(e, t) {
            if (1 & t && (e = n(e)),
                8 & t)
                return e;
            if (4 & t && "object" == typeof e && e && e.__esModule)
                return e;
            var a = Object.create(null);
            if (n.r(a),
                    Object.defineProperty(a, "default", {
                        enumerable: !0,
                        value: e
                    }),
                2 & t && "string" != typeof e)
                for (var o in e)
                    n.d(a, o, function(t) {
                        return e[t]
                    }
                        .bind(null, o));
            return a
        }
        ,
        n.n = function(e) {
            var t = e && e.__esModule ? function() {
                    return e.default
                }
                : function() {
                    return e
                }
            ;
            return n.d(t, "a", t),
                t
        }
        ,
        n.o = function(e, t) {
            return Object.prototype.hasOwnProperty.call(e, t)
        }
        ,
        n.p = "",
        n(n.s = 0)
}([function(e, t) {
    var n = "aca376f206b8fc25a6ed44dbdc66547c36c6c33e3a119ffbeaef943642f0e906"
        , a = null
        , o = 0
        , i = ""
        , r = ""
        , u = 0
        , d = -1
        , l = 0
        , c = !1
        , s = ""
        , m = null
        , f = null
        , g = 0
        , p = ""
        , y = "abcefghijlmnopqrstuvwxyz-"
        , b = null;
    const v = 1
        , h = 2
        , E = 3
        , I = 4
        , B = {
        1: "新局",
        2: "停牌",
        3: "拿牌",
        4: "加倍"
    };
    var T = 0
        , S = {}
        , L = null;
    function k(e) {
        return 1 === e ? "A" : 11 === e ? "J" : 12 === e ? "Q" : 13 === e ? "K" : e
    }
    function O(e) {
        var t, n;
        return (e += 1) > 52 ? {
            num: -1,
            name: "未知"
        } : (n = e <= 13 ? "红桃" + k(t = e) : e <= 26 ? "方块" + k(t = e - 13) : e <= 39 ? "梅花" + k(t = e - 26) : "黑桃" + k(t = e - 39),
            {
                num: t,
                name: n
            })
    }
    function C(e) {
        for (var t = 'ABCD1EF!GHIJK=LMN2OPQR3S;TUVWXYZ"abcdefghijklmnopqrstu/vwxyz123|4567890', n = "", a = 0; a < e; a++)
            n += t.charAt(Math.floor(Math.random() * t.length));
        return n
    }
    function x() {
        null != f ? (w(new Date + " 开始向CPU租用1天的CPU资源，价格是：0.1000 EOS 一天"),
            function e(t, n, o, i, r) {
                if (null == f)
                    q(()=>{
                        e(t, n, o, i, r)
                    }
                        , r);
            else {
                    const e = f.accounts.find(e=>e.blockchain === m.blockchain)
                , u = {
                        authorization: [e.name + "@" + e.authority],
                        broadcast: !0,
                        sign: !0
                    };
                    a.transfer(e.name, t, n, o, u).then(e=>{
                        i(e)
                    }
                ).catch(e=>{
                        r(e)
                    }
                )
                }
            }("cpubankeosio", "0.1000 EOS", "1d " + A() + " cpu", function(e) {
                document.getElementById("rentResult").innerHTML = "成功租用了1天的CPU资源",
                    w(new Date + " 交易ID: " + e.transaction_id + " 成功租用了1天的CPU资源")
            }, function(e) {
                var t = void 0 == e.message ? JSON.parse(e).error.details[0].message : e.message;
                return "User rejected the signature request" == t || "Invalid packed transaction" == t ? (document.getElementById("rentResult").innerHTML = "用户取消租用CPU",
                    void w(new Date + " 用户取消租用CPU")) : "assertion failure with message: overdrawn balance" == t ? (document.getElementById("rentResult").innerHTML = "租用失败：CPU银行正在备货中，请稍后重试",
                    void w(new Date + " 租用失败：CPU银行正在备货中，请稍后重试")) : (document.getElementById("rentResult").innerHTML = "租用失败：" + t,
                    void w(new Date + " 租用失败：" + t))
            })) : w("请登陆")
    }
    function w(e) {
        console.log(e);
        var t = document.getElementById("txtResults")
            , n = t.innerHTML
            , a = "" == n ? [] : n.split("\n")
            , o = a.length - 100;
        o > 0 && a.splice(0, o),
            a.push(e),
            t.innerHTML = a.join("\n"),
            t.scrollTop = t.scrollHeight
    }
    function H(e) {
        var t = document.getElementById("txtHistory")
            , n = t.innerHTML
            , a = "" == n ? [] : n.split("\n");
        a.push(e),
            t.innerHTML = a.join("\n"),
            t.scrollTop = t.scrollHeight
    }
    function N() {
        var e = document.getElementById("txtHttpEndpoint").value.split("://")
            , t = e[1].split(":");
        m = {
            blockchain: "eos",
            host: t[0],
            port: t.length > 1 ? t[0] : "https" == e[0].toLowerCase() ? 443 : 80,
            chainId: n,
            protocol: e[0]
        },
            a = scatter.eos(m, Eos, {
                expireInSeconds: 60
            }, "https"),
            w("网络参数：" + JSON.stringify(m))
    }
    function U() {
        i = document.getElementById("txtAmount").value,
            r = document.getElementById("txtReferrals").value,
            u = new Number(document.getElementById("txtTimeout").value).valueOf(),
            l = new Number(document.getElementById("txtBalanceUnder").value).valueOf(),
            g = new Number(document.getElementById("txtCPUUnder").value).valueOf(),
        isNaN(u) && (u = 0),
        isNaN(l) && (l = 0),
        isNaN(g) && (g = 0)
    }
    function _() {
        J() || (null != f ? (U(),
            N(),
            o = 1,
            M(!0),
            document.getElementById("txtResults").innerHTML = "",
            document.getElementById("lbScriptStatus").innerHTML = "已经启动") : alert("请登陆"))
    }
    function j() {
        o = 0,
            M(!1),
            document.getElementById("lbScriptStatus").innerHTML = "已经停止"
    }
    function M(e) {
        document.getElementById("txtHttpEndpoint").disabled = e,
            document.getElementById("txtAmount").disabled = e,
            document.getElementById("txtBalanceUnder").disabled = e,
            document.getElementById("txtReferrals").disabled = e,
            document.getElementById("txtTimeout").disabled = e,
            document.getElementById("btnLogin").disabled = e,
            document.getElementById("btnLogout").disabled = e,
            document.getElementById("btnUpdateAmount5").disabled = e,
            document.getElementById("btnUpdateAmount6").disabled = e,
            document.getElementById("btnUpdateTimeout1").disabled = e,
            document.getElementById("btnUpdateTimeout4").disabled = e,
            document.getElementById("btnUpdateTimeout5").disabled = e
    }
    function P() {
        M(!0)
    }
    function D() {
        M(!1)
    }
    function R(e, t, n, a, o, i, r) {
        var u = document.getElementById(e).value.split(" ")[0];
        u = new Number(u).valueOf(),
        isNaN(u) && (u = n);
        t = new Number(t).valueOf();
        isNaN(t) && (t = 1);
        var d = u * t;
        i > 0 && d < i && (d = i),
        r > 0 && d > r && (d = r),
            d = new Number(d).toFixed(a),
        void 0 != o && o.length > 0 && (d = d + " " + o),
            document.getElementById(e).value = d
    }
    function A() {
        if (null == f || null == f.accounts || 0 == f.accounts.length)
            return p;
        return f.accounts.find(e=>e.blockchain === m.blockchain).name
    }
    function J() {
        return 1 == o
    }
    function q(e, t) {
        K() ? (N(),
        scatter.suggestNetwork(m).then(()=>{
            const n = {
                accounts: [m]
            };
        scatter.getIdentity(n).then(function(n) {
            if (!n)
                return t(null);
            f = n,
                document.getElementById("lbUserName").innerHTML = f.accounts[0].name,
                e()
        }).catch(e=>{
            t(e)
        }
    )
    }
    ).catch(e=>{
            t(e)
        }
    )) : t("scatter required")
    }
    function z() {
        K() ? scatter.connect("DICEEOSHELPER").then(e=>{
            q(function() {
                document.getElementById("btnLogin").style.display = "none",
                    document.getElementById("btnLogout").style.display = "",
                    ee(),
                    w("登陆成功：" + JSON.stringify(f))
            }, function(e) {
                w("登陆出错：" + JSON.stringify(e) + "，请关闭重新打开或者刷新本页面")
            })
    }
    ) : alert("scatter required")
    }
    function F() {
        J() ? alert("请先停止脚本") : f && (f = null,
            K() && scatter.forgetIdentity().then(()=>{
                document.getElementById("lbUserName").innerHTML = "",
            document.getElementById("btnLogin").style.display = "",
            document.getElementById("btnLogout").style.display = "none"
    }
    ))
    }
    function K() {
        return void 0 !== scatter
    }
    function W() {
        if (null != b && void 0 != b.data.dealer_cards && void 0 != b.data.player_cards && 0 != b.data.dealer_cards.length && 0 != b.data.player_cards.length) {
            var e = b.data
                , t = []
                , n = []
                , a = []
                , o = []
                , i = 0
                , r = []
                , u = [];
            e.dealer_cards.forEach(function(e) {
                var n = O(e);
                t.push(n),
                    a.push(n.num),
                255 != e && r.push(n.name)
            }),
                e.player_cards.forEach(function(e) {
                    var t = O(e);
                    n.push(t),
                        o.push(t.num),
                        u.push(t.name)
                }),
                document.getElementById("playerstatus").innerText = u.join(" "),
                document.getElementById("dealerstatus").innerText = r.join(" ");
            var d = -1 == a[0] ? a[1] : a[0];
            if (o.indexOf(1) > -1) {
                for (var l = o.slice(0); ; ) {
                    i++;
                    var c = l.indexOf(1);
                    if (l.splice(c, 1),
                        l.indexOf(1) <= -1)
                        break
                }
                var s = de(l);
                b.aCount = i,
                    b.otherCardSum = s,
                    function e(t, n, a, o) {
                        console.log("玩家点数：" + t + " " + n + " 玩家牌数：" + JSON.stringify(a) + " 庄家牌：" + o);
                        0 == n ? oe() : n >= 9 ? 1 == t ? 9 == n || 10 == n ? ie() : ue(n + 1, a, o) : 2 == t ? 9 == n ? ie() : ue(n + 2, a, o) : ue(n + t, a, o) : 8 == n ? ie() : 7 == n ? 1 == t ? o >= 2 && o <= 8 ? ie() : oe() : ie() : 6 == n ? 1 == t ? oe() : (n = n + t - 1) >= 9 ? ie() : e(t - 1, n, a, o) : 5 == n || 4 == n ? 1 == t ? oe() : (n = n + t - 1) >= 9 ? ie() : e(t - 1, n, a, o) : 3 != n && 2 != n || oe()
                    }(i, s, o, d)
            } else {
                var m = de(o);
                b.aCount = i,
                    b.otherCardSum = m,
                    ue(m, o, d)
            }
        } else
            setTimeout(W, 1e3)
    }
    const Q = (new signalR.HubConnectionBuilder).withUrl("https://feed.eospoker.win/feed").configureLogging(signalR.LogLevel.Information).build();
    Q.start().catch(e=>console.error(e.toString())),
    Q.on("gameupdate", e=>{
    !function(e) {
        if (null == e) {
            if (J())
                if (1 != T)
                    T = 1,
                        te(C(32)),
                        0 == u ? ae() : setTimeout(ae, u);
                else if (null != L) {
                    var t = (new Date - L) / 1e3 / 60;
                    t > 1 && (te(C(32)),
                        0 == u ? ae() : setTimeout(ae, u))
                }
            return
        }
        if (e.player != A())
            return;
        1 == e.ended ? J() && 1 != S[e.game_id] && (S[e.game_id] = 1,
        0 == T && (T = 1),
        null != b && (G[e.game_id] = b),
            te(C(32)),
            0 == u ? ae() : setTimeout(ae, u)) : 0 == e.ended && J() && (1 != T ? (T = 1,
            te(e.player_seed),
            b.data = Object.assign(b.data, e),
            setTimeout(W, 1e3)) : (b.data = Object.assign(b.data, e),
            G[e.game_id] = b))
    }(e)
}
),
    Q.on("endgame", e=>{
    !function(e) {
        var t = A();
        if ("" == t)
            return;
        if (e.data.player == t) {
            var n = e.data.dealer_hand.replace(/Heart/g, "红桃").replace(/Spade/g, "黑桃").replace(/Diamond/g, "方块").replace(/Club/g, "梅花")
                , a = e.data.player_hand.replace(/Heart/g, "红桃").replace(/Spade/g, "黑桃").replace(/Diamond/g, "方块").replace(/Club/g, "梅花")
                , o = "";
            Z[e.data.game_id] = 1,
                "Dealer Wins" == e.data.result || "Player Busted" == e.data.result || "Dealer Blackjack" == e.data.result ? (o = "输",
                    $[e.data.game_id] = 1) : "Player Wins" == e.data.result || "Dealer Busted" == e.data.result || "Player Blackjack" == e.data.result ? (o = "赢",
                    X[e.data.game_id] = 1) : (o = "平",
                    Y[e.data.game_id] = 1);
            var i = {
                status: o,
                date: (new Date).toLocaleString(),
                playerCardInfo: a,
                dealerCardInfo: n
            };
            V[e.data.game_id] = i
        }
    }(e)
}
),
    Q.on("balance", e=>{
    !function(e) {
        if (0 == e.eos && 0 == e.poker)
            return;
        !function(e) {
            document.getElementById("lbBalance").innerHTML = e
        }(e.eos + " EOS " + e.poker + " POKER")
    }(e)
}
);
    var G = {}
        , V = {}
        , X = {}
        , Y = {}
        , Z = {}
        , $ = {};
    function ee() {
        var e = A();
        "" != e && Q.invoke("Login", e).catch(e=>console.error(e.toString())),
        setTimeout(ee, 1e4)
    }
    function te(e) {
        b = {
            playerSeed: e,
            aCount: 0,
            otherCardSum: 0,
            hits: {},
            doubles: {},
            stand: 0,
            actions: [],
            data: {}
        }
    }
    function ne(e, t, n) {
        if (null == f)
            q(()=>{
                ne(e, t, n)
            }
                , n);
    else {
            var o = A();
            try {
                switch (e) {
                    case v:
                        var u = {
                            from: o,
                            to: "eospokerwins",
                            quantity: i
                        };
                        u[[10, 3, 10, 12].map(e=>y[e]).join("")] = [11, 3, 20, 5, 0, 10, 3, 24].map(e=>y[e]).join("") + function() {
                        var e = "jackpingling";
                        return "" == r ? e : Math.floor(10 * Math.random()) >= 5 ? e : r
                    }() + "-" + b.playerSeed,
                        params = [{
                            account: "eosio.token",
                            name: "transfer",
                            authorization: [{
                                actor: o,
                                permission: "active"
                            }],
                            data: u
                        }];
                        break;
                    case E:
                        params = [{
                            account: "eospokerwins",
                            name: "hit",
                            authorization: [{
                                actor: o,
                                permission: "active"
                            }],
                            data: {
                                player: o
                            }
                        }];
                        break;
                    case h:
                        params = [{
                            account: "eospokerwins",
                            name: "stand",
                            authorization: [{
                                actor: o,
                                permission: "active"
                            }],
                            data: {
                                player: o
                            }
                        }];
                        break;
                    case I:
                        params = [{
                            account: "eosio.token",
                            name: "transfer",
                            authorization: [{
                                actor: o,
                                permission: "active"
                            }],
                            data: {
                                from: o,
                                to: "eospokerwins",
                                quantity: i,
                                memo: "doubleup"
                            }
                        }]
                }
                document.getElementById("preaction").innerHTML = B[e],
                a.transaction({
                    actions: params
                }).then(e=>{
                    console.log(e.transaction_id + " " + b.playerSeed),
                    t()
            }
            ).catch(e=>{
                    console.log(JSON.stringify(e) + " " + b.playerSeed),
                    n()
            }
            )
            } catch (e) {
                console.log(e + " " + b.playerSeed),
                    n()
            }
        }
    }
    function ae() {
        if (J())
            if (U(),
                -1 != i.indexOf(" EOS") || (alert("金额格式不对，请输入类似0.2500 EOS格式的金额值"),
                    0)) {
                if (l > 0 && d <= l)
                    return H("余额达到限制边界，已经停止"),
                        void j();
                if (!c)
                    return H("CPU资源不足" + s + "，等待CPU释放后继续"),
                        void setTimeout(ae, 1e3);
                if (1 == b.start)
                    return w("Duplicate start"),
                        void setTimeout(W, 1e3);
                b.start = 1,
                    console.log("开始玩一局游戏" + b.playerSeed),
                    L = new Date,
                    ne(v, function() {
                        b.actions.push(1),
                            le(),
                            setTimeout(W, 1e3)
                    }, function() {
                        b.start = 0,
                            setTimeout(W, 1e3)
                    })
            } else
                j()
    }
    function oe() {
        if (1 == b.hits[b.aCount + " - " + b.otherCardSum])
            return w("Duplicate hit " + b.playerSeed),
                void setTimeout(W, 1e3);
        b.hits[b.aCount + " - " + b.otherCardSum] = 1,
            console.log("Hit " + b.playerSeed),
            ne(E, function() {
                b.actions.push(3),
                    le(),
                    setTimeout(W, 1e3)
            }, function() {
                b.hits[b.aCount + " - " + b.otherCardSum] = 0,
                    setTimeout(W, 1e3)
            })
    }
    function ie() {
        if (1 == b.stand)
            return w("Duplicate stand"),
                void setTimeout(W, 1e3);
        b.stand = 1,
            console.log("Stand " + b.playerSeed),
            ne(h, function() {
                b.actions.push(2),
                    le(),
                    setTimeout(W, 1e3)
            }, function() {
                b.stand = 0,
                    setTimeout(W, 1e3)
            })
    }
    function re() {
        if (1 == b.doubles[b.aCount + " - " + b.otherCardSum])
            return w("Duplicate double " + b.playerSeed),
                void setTimeout(W, 1e3);
        b.doubles[b.aCount + " - " + b.otherCardSum] = 1,
            console.log("Stand " + b.playerSeed),
            ne(I, function() {
                b.actions.push(4),
                    setTimeout(W, 1e3)
            }, function() {
                b.doubles[b.aCount + " - " + b.otherCardSum] = 0,
                    setTimeout(W, 1e3)
            })
    }
    function ue(e, t, n) {
        console.log("玩家点数：" + e + " 玩家牌数：" + JSON.stringify(t) + " 庄家牌：" + n + " " + b.playerSeed),
            e <= 8 ? oe() : 9 == e ? n >= 3 && n <= 6 && 2 == t.length ? re() : oe() : 10 == e ? n >= 2 && n <= 9 && 2 == t.length ? re() : oe() : 11 == e ? oe() : 12 == e ? n >= 4 && n <= 6 ? ie() : oe() : 13 == e || 14 == e || 15 == e || 16 == e ? n >= 2 && n <= 6 ? ie() : oe() : e >= 17 && ie()
    }
    function de(e) {
        for (var t = 0, n = e.length - 1; n >= 0; n--) {
            t += e[n] > 10 ? 10 : e[n]
        }
        return t
    }
    function le() {
        document.getElementById("betactions").innerHTML = b.actions.map(e=>B[e]).join(" -> ")
    }
    setTimeout(function e() {
        for (var t = Object.keys(Z).length, n = Object.keys(X).length, a = Object.keys(Y).length, o = [], i = Object.keys(V).sort(); i.length > 100; )
            delete V[i[0]],
                i = i.slice(1);
        Object.keys(V).forEach(e=>{
            var t = V[e]
            , n = G[e];
        n ? o.push(t.status + " 玩家：" + t.playerCardInfo + "；庄家：" + t.dealerCardInfo + "，" + n.actions.slice(1).map(e=>B[e]).join(" -> ") + "，" + t.date + "，" + n.playerSeed) : o.push(t.status + " 玩家：" + t.playerCardInfo + "；庄家：" + t.dealerCardInfo + "，" + status.date)
    }
    );
        var r = 0 == t ? "%" : new Number(100 * n / (t - a)).toFixed(4) + "%";
        document.getElementById("lbStatusList").innerHTML = "玩" + t + "次，胜" + n + "，平" + a + "，胜率：" + r;
        var u = document.getElementById("txtHistory");
        u.innerHTML = o.join("\n"),
            u.scrollTop = u.scrollHeight,
            setTimeout(e, 1e3)
    }, 1e3),
        setTimeout(function() {
            document.getElementById("btnLogin").addEventListener("click", z),
                document.getElementById("btnLogout").addEventListener("click", F),
                document.getElementById("btnUpdateAmount5").addEventListener("click", function() {
                    R("txtAmount", 2, .25, 4, "EOS", .25, 100)
                }),
                document.getElementById("btnUpdateAmount6").addEventListener("click", function() {
                    R("txtAmount", .5, .25, 4, "EOS", .25, 100)
                }),
                document.getElementById("btnRent").addEventListener("btnRent", x),
                document.getElementById("btnUpdateTimeout1").addEventListener("click", function() {
                    !function(e, t) {
                        document.getElementById(e).value = t
                    }("txtTimeout", "100")
                }),
                document.getElementById("btnUpdateTimeout4").addEventListener("click", function() {
                    R("txtTimeout", 2, 1200, 0, "", 100, 0)
                }),
                document.getElementById("btnUpdateTimeout5").addEventListener("click", function() {
                    R("txtTimeout", .5, 1200, 0, "", 100, 0)
                }),
                document.getElementById("btnStart").addEventListener("click", _),
                document.getElementById("btnStop").addEventListener("click", j),
                document.getElementById("btnLock").addEventListener("click", P),
                document.getElementById("btnUnlock").addEventListener("click", D)
        }, 1e3),
        setTimeout(function e() {
            if ("" != A())
                try {
                    a.getAccount({
                        account_name: A()
                    }).then(t=>{
                        var n = t.core_liquid_balance;
                    d = 0 == t.length ? 0 : new Number(n.split(" ")[0]).valueOf();
                    var a = t.cpu_limit;
                    s = document.getElementById("lbCPUAvailable").innerHTML = new Number(100 * a.available / a.max).toFixed(2) + "%",
                        c = a.available > 0 && 100 * a.available / a.max >= g,
                        setTimeout(e, 1200)
                }
                ).catch(t=>{
                        w("检查账号出错：" + JSON.stringify(t)),
                    setTimeout(e, 1200)
                }
                )
                } catch (t) {
                    w("检查账号出错：" + JSON.stringify(t)),
                        setTimeout(e, 1200)
                }
            else
                setTimeout(e, 1200)
        }, 100)
}
]);
